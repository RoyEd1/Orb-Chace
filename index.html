<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Gravity Points Game</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background-color: #18231a;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }
    canvas {
      display: block;
    }
    #overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }
    .flash-message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #f1f1f1;
      font-size: 24px;
      background: rgba(0, 0, 0, 0.5);
      padding: 10px 20px;
      border-radius: 10px;
      opacity: 0;
      transition: opacity 0.3s;
    }
    #hud {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      color: #f1f1f1;
      padding: 10px;
      box-sizing: border-box;
      display: flex;
      justify-content: space-between;
    }
    #buy-menu {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      display: flex;
      justify-content: space-around;
      background: #212121;
      padding: 10px;
      box-sizing: border-box;
    }
    .buy-button {
      background: #212121;
      color: #f1f1f1;
      border: 2px solid #f1f1f1;
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div id="overlay">
    <div id="hud">
      <div>
        <div id="coins">Coins: 9999</div>
        <div id="coinValue">Value: 1</div>
      </div>
      <div id="level">Level 1-1</div>
      <div id="hp">HP: 0</div>
    </div>
    <div class="flash-message" id="flashMessage"></div>
    <div id="buy-menu">
      <button class="buy-button" onclick="buyUpgrade('speed')">Speed (10)</button>
      <button class="buy-button" onclick="buyUpgrade('size')">Size/HP (20)</button>
      <button class="buy-button" onclick="buyUpgrade('level')">Next Level (50)</button>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    let width = window.innerWidth;
    let height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;

    const flashMessage = document.getElementById('flashMessage');
    const hud = {
      coins: document.getElementById('coins'),
      coinValue: document.getElementById('coinValue'),
      level: document.getElementById('level'),
      hp: document.getElementById('hp')
    };

    let coins = 9999;
    let coinValue = 1;
    let baseCoinValue = 1;
    let hp = 0;
    let mainLevel = 1;
    let subLevel = 1;
    let enemies = [];

    const player = {
      x: width / 2,
      y: height / 2,
      radius: 8,
      color: '#ffffff',
      speed: 3,
      target: { x: width / 2, y: height / 2 }
    };

    const gravityPoints = [];
    const totalPoints = () => 10 + (mainLevel >= 6 ? mainLevel - 5 : 0);

    function spawnPoints() {
      gravityPoints.length = 0;
      for (let i = 0; i < totalPoints(); i++) {
        gravityPoints.push({
          x: Math.random() * width,
          y: Math.random() * height,
          radius: 12,
          color: '#d2de26'
        });
      }
    }

    function spawnEnemies() {
      enemies = [];
      let enemyCount = mainLevel >= 5 ? 2 : (mainLevel >= 2 ? 1 : 0);
      if (mainLevel === 10) enemyCount = 3;
      for (let i = 0; i < enemyCount; i++) {
        enemies.push({
          x: Math.random() * width,
          y: Math.random() * height,
          radius: i === 2 ? 30 : 20,
          color: '#ed6c4e',
          speed: 1.2 + (mainLevel >= 7 ? 0.5 : 0)
        });
      }
    }

    function showFlashMessage(text) {
      flashMessage.textContent = text;
      flashMessage.style.opacity = 1;
      setTimeout(() => flashMessage.style.opacity = 0, 1000);
    }

    function buyUpgrade(type) {
      if (type === 'speed' && coins >= 10) {
        coins -= 10;
        player.speed += 0.5;
        showFlashMessage('Speed Upgraded!');
      } else if (type === 'size' && coins >= 20) {
        coins -= 20;
        hp++;
        player.radius += 2;
        showFlashMessage('Size/HP Increased!');
      } else if (type === 'level' && coins >= 50) {
        coins -= 50;
        mainLevel++;
        subLevel = 1;
        baseCoinValue *= 2;
        coinValue = baseCoinValue;
        spawnEnemies();
        spawnPoints();
        showFlashMessage('Advanced to Next Level!');
      }
    }

    function updateHUD() {
      hud.coins.textContent = `Coins: ${coins}`;
      hud.coinValue.textContent = `Value: ${coinValue}`;
      hud.level.textContent = `Level ${mainLevel}-${subLevel}`;
      hud.hp.textContent = `HP: ${hp}`;
    }

    window.addEventListener('click', (e) => {
      player.target.x = e.clientX;
      player.target.y = e.clientY;
    });

    function update() {
      const dx = player.target.x - player.x;
      const dy = player.target.y - player.y;
      const dist = Math.hypot(dx, dy);
      if (dist > player.speed) {
        player.x += (dx / dist) * player.speed;
        player.y += (dy / dist) * player.speed;
      }

      enemies.forEach(enemy => {
        const edx = player.x - enemy.x;
        const edy = player.y - enemy.y;
        const edist = Math.hypot(edx, edy);
        if (edist > 1) {
          enemy.x += (edx / edist) * enemy.speed;
          enemy.y += (edy / edist) * enemy.speed;
        }

        if (Math.hypot(player.x - enemy.x, player.y - enemy.y) < enemy.radius + player.radius) {
          if (hp > 0) {
            hp--;
            player.radius -= 2;
            enemy.x += (Math.random() - 0.5) * 100;
            enemy.y += (Math.random() - 0.5) * 100;
          }
        }
      });

      for (let i = gravityPoints.length - 1; i >= 0; i--) {
        const p = gravityPoints[i];
        const pdx = p.x - player.x;
        const pdy = p.y - player.y;
        const dist = Math.hypot(pdx, pdy);

        if (dist < p.radius + player.radius) {
          gravityPoints.splice(i, 1);
          coins += coinValue;
        }
      }

      if (gravityPoints.length === 0) {
        subLevel++;
        if (subLevel > 10) subLevel = 1;
        coinValue = Math.min(baseCoinValue + subLevel - 1, 10 * baseCoinValue);
        spawnPoints();
        spawnEnemies();
      }

      updateHUD();
    }

    function drawCircle(x, y, radius, color) {
      ctx.beginPath();
      ctx.arc(x, y, radius, 0, Math.PI * 2);
      ctx.fillStyle = color;
      ctx.fill();
    }

    function draw() {
      ctx.clearRect(0, 0, width, height);
      gravityPoints.forEach(p => drawCircle(p.x, p.y, p.radius, p.color));
      enemies.forEach(e => drawCircle(e.x, e.y, e.radius, e.color));
      drawCircle(player.x, player.y, player.radius, player.color);
    }

    function loop() {
      update();
      draw();
      requestAnimationFrame(loop);
    }

    spawnPoints();
    spawnEnemies();
    loop();
  </script>
</body>
</html>
