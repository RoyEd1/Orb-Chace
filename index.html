<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Gravity Points</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #18231a;
      overflow: hidden;
    }
    canvas {
      display: block;
    }
    #ui {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      color: #f1f1f1;
      font-family: sans-serif;
      pointer-events: none;
    }
    #ui .top {
      display: flex;
      justify-content: space-between;
      padding: 5px 10px;
    }
    #level-display {
      text-align: center;
      font-size: 18px;
    }
    #buy-menu {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background: rgba(0,0,0,0.7);
      display: flex;
      justify-content: space-around;
      padding: 5px 0;
      pointer-events: auto;
    }
    .btn {
      background: #212121;
      color: #f1f1f1;
      border: none;
      padding: 8px 12px;
      margin: 2px;
      font-size: 14px;
      border-radius: 4px;
      cursor: pointer;
    }
    #shoot-button {
      position: absolute;
      bottom: 70px;
      right: 10px;
      background: #212121;
      color: #f1f1f1;
      padding: 10px;
      border-radius: 50%;
      border: none;
      pointer-events: auto;
      display: none;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div id="ui">
    <div class="top">
      <div>
        Coins: <span id="coinDisplay">9999</span><br>
        Orb Value: <span id="orbValueDisplay">1</span>
      </div>
      <div id="level-display">Level 1-1</div>
      <div>
        HP: <span id="hpDisplay">1</span>
      </div>
    </div>
  </div>
  <div id="buy-menu">
    <button class="btn" id="buySpeed">Speed (<span id="speedPrice">100</span>)</button>
    <button class="btn" id="buySize">Size (<span id="sizePrice">100</span>)</button>
    <button class="btn" id="buyLevel">Level Up (<span id="levelPrice">200</span>)</button>
    <button class="btn" id="buyHunter">Hunter Mode (<span id="hunterPrice">400</span>)</button>
  </div>
  <button id="shoot-button">Shoot</button>

  <script>
    // Game constants
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    let width = window.innerWidth;
    let height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;

    // UI Elements
    const coinDisplay = document.getElementById("coinDisplay");
    const orbValueDisplay = document.getElementById("orbValueDisplay");
    const hpDisplay = document.getElementById("hpDisplay");
    const levelDisplay = document.getElementById("level-display");
    const shootButton = document.getElementById("shoot-button");

    // Player state
    const player = {
      x: width / 2,
      y: height / 2,
      radius: 10,
      color: "#ffffff",
      speed: 3,
      target: { x: width / 2, y: height / 2 },
      hp: 1,
      hasHunter: false,
      canShoot: false,
      aimDir: { x: 0, y: 0 }
    };

    // Game state
    let coins = 9999;
    let orbValue = 1;
    let level = 1;
    let subLevel = 1;
    let gravityPoints = [];
    let enemies = [];
    let shot = null;

    const PRICES = {
      speed: 100,
      size: 100,
      level: 200,
      hunter: 400
    };

    const MAX_LEVEL = 10;
    const SUB_LEVELS = 10;

    function updateUI() {
      coinDisplay.textContent = coins;
      orbValueDisplay.textContent = orbValue;
      hpDisplay.textContent = player.hp;
      levelDisplay.textContent = `Level ${level}-${subLevel}`;
      document.getElementById("speedPrice").textContent = PRICES.speed;
      document.getElementById("sizePrice").textContent = PRICES.size;
      document.getElementById("levelPrice").textContent = PRICES.level;
      document.getElementById("hunterPrice").textContent = PRICES.hunter;
      shootButton.style.display = player.hasHunter ? "block" : "none";
    }

    function spawnOrbs() {
      gravityPoints = [];
      const count = 10 + level - 1;
      for (let i = 0; i < count; i++) {
        gravityPoints.push({
          x: Math.random() * width * 0.8 + width * 0.1,
          y: Math.random() * height * 0.8 + height * 0.1,
          radius: 10,
          color: "#d2de26"
        });
      }
    }

    function spawnEnemies() {
      enemies = [];
      if (level >= 2) enemies.push(newEnemy());
      if (level >= 5) enemies.push(newEnemy());
      if (level === 10) enemies.push(newEnemy(true));
    }

    function newEnemy(big = false) {
      return {
        x: Math.random() * width,
        y: Math.random() * height,
        radius: big ? 30 : 20,
        speed: 1 + level * 0.2,
        color: big ? "#cc2222" : "#ed6c4e"
      };
    }

    function nextSubLevel() {
      subLevel++;
      if (subLevel > SUB_LEVELS) {
        subLevel = 1;
        level++;
        orbValue *= 2;
        if (level > MAX_LEVEL) {
          winGame();
          return;
        }
      } else if (orbValue < 10) {
        orbValue += 1;
      }
      player.canShoot = true;
      spawnOrbs();
      spawnEnemies();
      updateUI();
    }

    function winGame() {
      alert("You win! AI takes over.");
    }

    function drawCircle(x, y, r, color) {
      ctx.beginPath();
      ctx.arc(x, y, r, 0, Math.PI * 2);
      ctx.fillStyle = color;
      ctx.fill();
    }

    function updateGame() {
      // Move player
      const dx = player.target.x - player.x;
      const dy = player.target.y - player.y;
      const dist = Math.hypot(dx, dy);
      if (dist > player.speed) {
        player.aimDir = { x: dx / dist, y: dy / dist };
        player.x += player.aimDir.x * player.speed;
        player.y += player.aimDir.y * player.speed;
      }

      // Move orbs away from player
      for (let orb of gravityPoints) {
        const odx = orb.x - player.x;
        const ody = orb.y - player.y;
        const oDist = Math.hypot(odx, ody);
        const fleeSpeed = level >= 4 ? 1.5 : 0.5;
        if (oDist < 200) {
          orb.x += (odx / oDist) * fleeSpeed;
          orb.y += (ody / oDist) * fleeSpeed;
        }
      }

      // Check orb collection
      for (let i = gravityPoints.length - 1; i >= 0; i--) {
        let orb = gravityPoints[i];
        if (Math.hypot(orb.x - player.x, orb.y - player.y) < orb.radius + player.radius) {
          gravityPoints.splice(i, 1);
          coins += orbValue;
          updateUI();
        }
      }

      // Check level clear
      if (gravityPoints.length === 0) {
        nextSubLevel();
      }

      // Move enemies
      for (let enemy of enemies) {
        const edx = player.x - enemy.x;
        const edy = player.y - enemy.y;
        const eDist = Math.hypot(edx, edy);
        if (eDist > 1) {
          enemy.x += (edx / eDist) * enemy.speed;
          enemy.y += (edy / eDist) * enemy.speed;
        }

        if (eDist < enemy.radius + player.radius) {
          if (player.hp > 0) {
            player.hp--;
            player.radius = 10 + player.hp * 2;
            updateUI();
          } else {
            alert("Game Over!");
            window.location.reload();
          }
        }
      }

      // Move shot
      if (shot) {
        shot.x += shot.dx;
        shot.y += shot.dy;
        for (let i = enemies.length - 1; i >= 0; i--) {
          if (Math.hypot(shot.x - enemies[i].x, shot.y - enemies[i].y) < enemies[i].radius) {
            enemies.splice(i, 1);
            shot = null;
            player.canShoot = true;
            break;
          }
        }
        if (shot && (shot.x < 0 || shot.x > width || shot.y < 0 || shot.y > height)) {
          shot = null;
        }
      }
    }

    function drawGame() {
      ctx.clearRect(0, 0, width, height);
      for (let orb of gravityPoints) drawCircle(orb.x, orb.y, orb.radius, orb.color);
      for (let enemy of enemies) drawCircle(enemy.x, enemy.y, enemy.radius, enemy.color);
      if (player.hasHunter) {
        ctx.beginPath();
        ctx.moveTo(player.x, player.y);
        ctx.lineTo(player.x + player.aimDir.x * 30, player.y + player.aimDir.y * 30);
        ctx.strokeStyle = "#00ffff";
        ctx.stroke();
      }
      drawCircle(player.x, player.y, player.radius, player.color);
      if (shot) drawCircle(shot.x, shot.y, 5, "#000000");
    }

    function loop() {
      updateGame();
      drawGame();
      requestAnimationFrame(loop);
    }

    window.addEventListener("click", (e) => {
      player.target = { x: e.clientX, y: e.clientY };
    });

    shootButton.addEventListener("click", () => {
      if (player.canShoot && player.hasHunter) {
        player.canShoot = false;
        shot = {
          x: player.x,
          y: player.y,
          dx: player.aimDir.x * 6,
          dy: player.aimDir.y * 6
        };
      }
    });

    document.getElementById("buySpeed").addEventListener("click", () => {
      if (coins >= PRICES.speed) {
        coins -= PRICES.speed;
        player.speed += 0.5;
        PRICES.speed = Math.floor(PRICES.speed * 1.5);
        updateUI();
      }
    });

    document.getElementById("buySize").addEventListener("click", () => {
      if (coins >= PRICES.size) {
        coins -= PRICES.size;
        player.hp++;
        player.radius = 10 + player.hp * 2;
        PRICES.size = Math.floor(PRICES.size * 1.5);
        updateUI();
      }
    });

    document.getElementById("buyLevel").addEventListener("click", () => {
      if (coins >= PRICES.level && level < MAX_LEVEL) {
        coins -= PRICES.level;
        subLevel = 0;
        nextSubLevel();
        PRICES.level = Math.floor(PRICES.level * 2);
        updateUI();
      }
    });

    document.getElementById("buyHunter").addEventListener("click", () => {
      if (!player.hasHunter && coins >= PRICES.hunter && level >= 5) {
        coins -= PRICES.hunter;
        player.hasHunter = true;
        PRICES.hunter = Math.floor(PRICES.hunter * 2);
        updateUI();
      }
    });

    spawnOrbs();
    spawnEnemies();
    updateUI();
    loop();
  </script>
</body>
</html>
